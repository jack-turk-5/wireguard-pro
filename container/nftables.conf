#!/usr/sbin/nft -f

flush ruleset

# Filter table for forwarding rules
table inet filter {
    chain forward {
        type filter hook forward priority 0; policy accept;

        # 1) Allow related and established connections
        ct state related,established accept  # :contentReference[oaicite:0]{index=0}

        # 2) Allow forwarding from wg0 to any tap* interface
        iifname "wg0" oifname "tap*" accept  # :contentReference[oaicite:1]{index=1}

        # 3) Reject traffic from wg0 to the 172.26.0.0/24 & 172.26.15.0/24 subnets
        iifname "wg0" ip daddr {172.26.0.0/24, 172.26.15.0/24} reject  # :contentReference[oaicite:2]{index=2}
    }
}

# NAT table for masquerading outbound traffic
table ip nat {
    chain postrouting {
        type nat hook postrouting priority 100; policy accept;

        # 4) Masquerade all traffic going out on tap* interfaces
        oifname "tap*" masquerade  # :contentReference[oaicite:3]{index=3}
    }
}