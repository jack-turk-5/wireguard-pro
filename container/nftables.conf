#!/usr/sbin/nft -f

flush ruleset

#–– Allow forwarding between wg0 and eth0 both ways, plus block your container subnets
table inet filter {
  chain forward {
    type filter hook forward priority 0; policy drop;

    # keep related/established flows going
    ct state related,established accept

    # allow new+established from wg0 → eth0
    iifname "wg0" oifname "eth0" ct state new,established accept

    # allow new+established from eth0 → wg0
    iifname "eth0" oifname "wg0" ct state new,established accept

    # block any attempts to reach your container LANs from the tunnel
    iifname "wg0" ip daddr { 172.26.0.0/24, 172.26.15.0/24 } reject
  }
}

#–– Masquerade everything going out via eth0
table ip nat {
  chain postrouting {
    type nat hook postrouting priority 100; policy accept;
    oifname "eth0" masquerade
  }
}