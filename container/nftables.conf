#!/usr/sbin/nft -f

flush ruleset

table inet filter {
    chain input {
        type filter hook input priority 0; policy accept;
        # allow wireguard traffic
        udp dport 51820 accept;
    }
    chain forward {
        type filter hook forward priority filter; policy drop;
        # allow established/related connections
        ct state established,related accept
        # allow forwarding from wireguard to the container's network
        iifname "wg0" oifname "eth0" accept
    }
}

table ip nat {
    chain postrouting {
        type nat hook postrouting priority 100; policy accept;
        # masquerade traffic from wireguard
        oifname "eth0" masquerade
    }
}